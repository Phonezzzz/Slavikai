# M5 — MWV hardening (routing + verifier gate + UX отчёт)

## Что изменено
- Уточнён UX‑формат ответа MWV: краткий итог + изменения + статус verifier + next steps + компактные детали.
- Ужесточён gate: успех возможен только при `VerificationStatus.PASSED`.
- Retry‑политика закреплена как детерминированная и ограниченная (макс. 3 попытки: 1 основная + 2 ретрая).
- Retry‑контекст задаёт более строгие ограничения по мере роста попыток.

## Логика ретраев (фиксировано)
- Попытка 1: базовая работа Worker.
- Если verifier FAIL:
  - Попытка 2: минимальный фикс по логам проверки.
  - Попытка 3: максимально минимальный diff (менять только строки, из-за которых падают проверки).
- После 3-й попытки — остановка с отчётом, без бесконечного цикла.

## Формат ответа MWV (UX)
1) Короткий итог (1–3 строки):
   - Итог + попытка + статус verifier.
2) Что изменено:
   - список файлов, 1 строка на файл.
3) Если FAIL:
   - «Что дальше» (1–3 пункта).
4) Детали:
   - компактный блок (план + 1‑строчный verifier summary), без простыней.

## Как проверить
- `make check`
- `pytest`
- coverage >= 80%

## Ограничения
- MWV не трогает approvals: `ApprovalRequired` пробрасывается как раньше.
- HTTP/внешние API не менялись.
- Старые режимы не возвращались.
