# ROUTING_POLICY — M2 (chat vs MWV)

Документ фиксирует детерминированную маршрутизацию между режимами:
- `chat` — ответы без инструментов (объяснения/консультации).
- `mwv` — задачи с изменениями/инструментами (Manager → Worker → Verifier).

Интеграции в runtime **нет**. Это только политика + тесты.

## Правила (жёстко, без магии)

Маршрут `mwv`, если обнаружены явные триггеры:
- “изменить/написать код”, “рефактор”, “почини тесты”, “добавь фичу”.
- команды/инструменты: `git`, `pip`, `npm`, `docker`, `systemctl`, `sudo`.
- файловые действия: patch/write/delete/overwrite и т.п.

Маршрут `chat`, если запрос — объяснение/теория/консультация, без явных действий.

## Что отдаёт политика

`RouteDecision`:
- `route`: `"chat"` или `"mwv"`.
- `reason`: короткая причина (для логов).
- `risk_flags`: список флагов (например `code_change`, `tools`, `filesystem`, `install`, `git`, `sudo`).

## Примеры (таблица)

| Пример запроса | Route | Почему |
| --- | --- | --- |
| “что такое git” | chat | объяснение, нет действий |
| “как работает sudo” | chat | объяснение, нет действий |
| “исправь тесты” | mwv | кодовые изменения (`code_change`) |
| “рефактор модуля оплаты” | mwv | кодовые изменения (`code_change`) |
| “добавь фичу логирования” | mwv | кодовые изменения (`code_change`) |
| “git commit -m 'x'” | mwv | git‑действие (`git`, `tools`) |
| “сделай PR” | mwv | git‑действие (`git`, `tools`) |
| “pip install requests” | mwv | установка deps (`install`, `tools`) |
| “npm install” | mwv | установка deps (`install`, `tools`) |
| “sudo systemctl restart nginx” | mwv | sudo/системная команда (`sudo`, `tools`) |
| “systemctl restart nginx” | mwv | системная команда (`tools`) |
| “удали файл README.md” | mwv | файловое действие (`filesystem`, `tools`) |
| “перезапиши файл config.yaml” | mwv | файловое действие (`filesystem`, `tools`) |
| “применить патч для README” | mwv | файловое действие (`filesystem`, `tools`) |
| “объясни, как работает TCP” | chat | объяснение, без инструментов |

## Ограничения

- Политика **не** запускает инструменты и **не** трогает runtime‑пайплайн.
- Это только классификатор; wiring будет обсуждаться отдельно (M3/M4).
